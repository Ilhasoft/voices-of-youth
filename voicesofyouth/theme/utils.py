import struct

from django.conf import settings

from voicesofyouth.core.tools.image import change_colors


def generate_pin(color_id, color_hex):
    """
    Generate a new pin with color = color_hex.
    """
    if len(color_hex) != 6:
        raise ValueError('You must inform the color hex in the following format: RRGGBB')

    try:
        int(color_hex, 16)
    except ValueError:
        raise ValueError('You must inform the color hex in the following format: RRGGBB')

    color_rgb = struct.unpack('BBB', bytes.fromhex(color_hex))
    change_colors(settings.PIN_ROOT.child('pin_base.png'),
                  settings.PIN_ROOT.child(f'{color_id}.png'),
                  [(15, 186, 232), (10, 182, 60), (14, 181, 226), (7, 91, 114), (4, 56, 70), (12, 159, 198), (14, 175, 218), (13, 172, 214), (6, 80, 100), (12, 156, 195), (13, 169, 211), (9, 113, 141), (11, 142, 178), (14, 184, 230), (14, 183, 228), (8, 109, 136), (11, 145, 181), (9, 120, 150), (11, 142, 178), (14, 177, 221), (7, 94, 117), (13, 172, 215), (9, 115, 144), (13, 168, 210), (12, 150, 188), (12, 157, 196), (14, 175, 219), (9, 117, 146), (6, 75, 94), (13, 165, 206), (7, 96, 210), (14, 185, 231), (11, 140, 174), (8, 110, 138), (14, 174, 217), (13, 161, 201), (11, 140, 174), (13, 164, 204), (6, 84, 105), (12, 153, 191), (12, 154, 192), (7, 91, 113), (14, 185, 213), (14, 183, 229), (11, 142, 177), (10, 134, 167), (13, 164, 205), (10, 127, 159), (11, 136, 170), (12, 155, 193), (7, 95, 119), (14, 179, 223), (9, 121, 151), (14, 178, 222), (9, 118, 147), (13, 163, 203), (7, 88, 110), (9, 114, 142), (6, 85, 106), (11, 137, 171), (6, 82, 102), (10, 131, 163), (7, 96, 120), (7, 90, 112), (10, 132, 165), (11, 146, 182), (9, 118, 148), (12, 156, 194), (14, 173, 216), (12, 158, 197), (8, 107, 133), (14, 182, 227), (10, 126, 157), (11, 141, 176), (8, 99, 123), (12, 159, 199), (8, 103, 129), (10, 132, 164), (5, 70, 87), (13, 167, 209), (5, 66, 82), (5, 63, 79), (4, 59, 74), (4, 49, 61), (6, 74, 92), (6, 83, 103), (8, 102, 127), (7, 89, 111), (14, 176, 220), (12, 150, 187), (11, 147, 183), (10, 128, 160), (5, 73, 91), (8, 101, 126), (12, 149, 186), (7, 87, 109), (8, 99, 124), (6, 81, 101), (14, 180, 225), (11, 140, 175), (6, 76, 95), (13, 171, 213), (5, 72, 90), (13, 167, 208), (10, 124, 154), (10, 129, 161), (9, 115, 143), (10, 125, 156), (5, 70, 88), (12, 160, 200), (5, 69, 86), (4, 55, 69), (5, 62, 77), (4, 61, 76), (4, 57, 71), (4, 58, 72), (7, 92, 115), (3, 45, 56), (12, 148, 185), (10, 124, 155), (9, 112, 140), (11, 138, 172), (6, 83, 104), (10, 134, 168), (8, 105, 131), (6, 76, 95), (13, 171, 213), (8, 102, 128), (12, 152, 190)],
                  color_rgb)

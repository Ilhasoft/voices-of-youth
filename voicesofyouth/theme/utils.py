import struct

from django.conf import settings

from voicesofyouth.core.tools.image import change_colors


def generate_pin(color_hex):
    """
    Generate a new pin with color = color_hex.
    """
    if len(color_hex) != 6:
        raise ValueError('You must inform the color hex in the following format: RRGGBB')

    try:
        int(color_hex, 16)
    except ValueError:
        raise ValueError('You must inform the color hex in the following format: RRGGBB')

    color_rgb = struct.unpack('BBB', bytes.fromhex(color_hex))
    change_colors(settings.PIN_ROOT.child('pin_base.png'),
                  settings.PIN_ROOT.child(f'{color_hex}.png'),
                  [(12, 187, 232), (12, 187, 233), (13, 188, 234), (14, 187, 233), (14, 191, 232), (13, 188, 232),
                   (12, 188, 233), (15, 193, 240), (13, 187, 233), (12, 188, 234), (16, 187, 235), (13, 187, 232),
                   (16, 187, 234), (13, 188, 233), (14, 188, 234), (12, 189, 234), (15, 188, 233), (14, 189, 233),
                   (14, 190, 236), (14, 187, 232), (14, 189, 234), (13, 189, 233), (13, 187, 234), (19, 189, 236),
                   (12, 189, 232), (16, 191, 234), (14, 190, 234), (13, 190, 235), (14, 188, 233), (16, 189, 239),
                   (12, 188, 232), (12, 188, 232), (17, 187, 232), (13, 189, 232), (18, 190, 237), (14, 188, 232),
                   (16, 188, 235), (13, 191, 242), (14, 187, 234), (15, 189, 236), (13, 189, 234), (18, 193, 237),
                   (14, 190, 233), (13, 189, 235), (20, 194, 235), (15, 191, 235), (12, 193, 236), (14, 198, 241),
                   (51, 204, 255), (13, 188, 235), (17, 187, 238), (14, 189, 232), (15, 190, 234), (13, 190, 232),
                   (14, 188, 236), (13, 190, 233), (36, 219, 255), (14, 187, 235), (85, 255, 255), (18, 191, 237),
                   (16, 190, 233), (16, 191, 239), (16, 190, 233), (12, 190, 235), (12, 190, 233), (14, 189, 236),
                   (12, 194, 243), (17, 188, 233), (17, 191, 238), (20, 196, 235), (32, 191, 255), (20, 196, 235),
                   (43, 213, 255), (23, 209, 255), (15, 195, 240), (22, 188, 233)],
                  color_rgb)

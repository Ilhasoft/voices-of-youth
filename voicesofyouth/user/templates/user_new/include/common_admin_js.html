<script>
    {# Update the chosen with selected projects. #}
    var projects = [];
    {% for project in user.projects.all %}
        projects.push('{{ project.id }}');
    {% endfor %}

    const elem = $('form[id=editUserForm] select[id=id_projects]');
    elem.val(projects).trigger('chosen:updated');
</script>

<script>
    $("select[id='id_projects']").chosen();
    $('#id_projects').removeAttr('required');
    {% if user.is_superuser %}
        $('form[id=editUserForm] input[id=id_global_admin_0]').prop('checked', true);
    {% else %}
        $('form[id=editUserForm] input[id=id_global_admin_1]').prop('checked', true);
    {% endif %}

    function disable_local_admin_fields() {
        $('[id=id_projects_chosen],[for^=id_projects]').removeAttr('required').hide();
    }

    function enable_local_admin_fields() {
        $('[id=id_projects_chosen],[for^=id_projects]').attr('required', true).show();
        $('#id_projects').trigger('chosen:updated');
    }

    if ($('input[id^=id_global_admin]:checked').val() === 'local') {
        enable_local_admin_fields();
    } else {
        disable_local_admin_fields();
    }

    $('input[id^=id_global_admin]').change((evt) => {
        if (evt.target.value === 'local') {
            enable_local_admin_fields();
        } else {
            disable_local_admin_fields();
        }
    })
</script>

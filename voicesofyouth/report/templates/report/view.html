{% extends "voyadmin/base.html" %}

{% load static i18n sass_tags %}

{% block extracss %}
    <link rel="stylesheet" href="{% sass_src 'css/report/report.scss' %}">
{% endblock %}

{% block content %}
<section>
    <div class="content-wrapper" id="view-report">
        <div class="content-heading">
            {{ report.name }}
        </div>

        <ol class="breadcrumb">
            <li><a href="{% url 'voy-admin:projects:index' %}">{% trans 'My projects' %}</a></li>
            <li><a href="{% url 'voy-admin:themes:index' theme.project.pk %}">{{ theme.project.name }}</a></li>
            <li><a href="{% url 'voy-admin:reports:index' theme.pk %}">{{ theme.name }}</a></li>
            <li>{% trans 'Reports' %}</li>
            <li>{{ report.name }}</li>
        </ol>

        <div class="panel">
            <div class="panel-body">
                <div class="pull-right buttons">
                    {% if report.status != 3 %}
                    <a href="{% url 'voy-admin:reports:edit' report.pk %}" class="btn btn-default edit">Edit</a>
                    {% endif %}

                    {% if report.status == 1 %}
                    <a class="btn btn-default delete">Delete</a>
                    {% endif %}

                    {% if report.status == 2 %}
                    <a href="javascript:;" class="btn btn-default reject" id="openModal">Reject</a>
                    <a href="{% url 'voy-admin:reports:approve' report.pk %}" class="btn btn-default approve">Approve</a>
                    {% endif %}
                </div>

                <h3 class="mt0">{{ report.name }}</h3>
                {% trans 'By' %} {{ report.created_by.first_name }} {{ report.created_on|date:'d M Y' }} {{ report.comments.count }} {% trans 'comments' %}
                <hr>

                <div class="row mb-lg">
                    <div class="col-lg-12 col-md-12">{{ report.description }}</div>      
                </div>

                <div class="row mb-lg">
                    {% for file in report.files.all %}
                        <div class="col-md-4">
                            {% if file.media_type == 'image' %}
                                <img src="{{ file.file.url }}" alt="" class="img-responsive">
                            {% elif file.media_type == 'video' %}
                                <video src="{{ file.file.url }}"></video>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
             </div>
        </div>
    </div>
</section>

<!-- modal -->
<div id="modal">
    <div class="opacity"></div>
    <div class="content-modal">
        <form action="{% url 'voy-admin:reports:view' report.pk %}" id="formReject" method="post">
            <fieldset>
                <input type="hidden" name="report" value="{{ report.pk }}"/>
                {% csrf_token %}
                <div class="row">
                    <div class="col-md-12 text-center pt-10">
                        <h4>{% trans 'Feedback message' %}</h4>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12 text-center">
                        <textarea name="message" id="message" cols="40" rows="5"></textarea>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12 buttons text-right">
                        <a href="javascript:;" class="btn btn-default cancel" id="closeModal">{% trans 'Cancel' %}</a>
                        <a href="javascript:;" id="submitReject" class="btn btn-default send">{% trans 'Send' %}</a>
                    </div>
                </div>
            </fieldset>
        </form>
    </div>
</div>
{% endblock %}

{% block extrajs %}
<script type="text/javascript">
$('#openModal').click(function(e) {
    e.preventDefault();
    $('#modal').show();
});

$('#closeModal').click(function(e) {
    e.preventDefault();
    $('#modal').hide();
});

$('#submitReject').click(function() {
    if ($('#message').val()) {
        $('#formReject').submit();
    }
})
</script>
{% endblock %}

{% extends "voyadmin/base.html" %}

{% load static i18n sass_tags %}

{% block extracss %}
    <link rel="stylesheet" href="{% sass_src 'css/report/report.scss' %}">
{% endblock %}

{% block content %}
<section>
    <div class="content-wrapper" id="report">
        <div class="content-heading">
            {{ theme.name }}
        </div>

        <ol class="breadcrumb">
            <li><a href="{% url 'voy-admin:projects:index' %}">{% trans 'My projects' %}</a></li>
            <li><a href="{% url 'voy-admin:themes:index' theme.project.pk %}">{{ theme.project.name }}</a></li>
            <li><a href="{% url 'voy-admin:reports:index' theme.pk %}">{{ theme.name }}</a></li>
            <li>{% trans 'Reports' %}</li>
        </ol>

        <div class="content-heading">
            <div class="row">
                <form action="" method="GET" id="form_search">
                    <div class="col-lg-1 col-md-1">
                        <p class="filter">{% trans 'Filter by:' %}</p>
                    </div>

                    <div class="col-lg-3 col-md-3">
                        {{ filter_form.theme }}
                    </div>

                    <div class="col-lg-3 col-md-3">
                        {{ filter_form.tag }}
                    </div>

                    <div class="col-lg-2 col-md-2">
                        <select name="account" class="form-control m-b">
                            option
                            <option>Option 1</option>
                            <option>Option 2</option>
                            <option>Option 3</option>
                            <option>Option 4</option>
                        </select>
                    </div>

                    <div class="col-lg-3 col-md-3 pull-right">
                        <div class="input-group m-b">
                            {{ filter_form.search }}
                            <span class="input-group-addon fa fa-search"></span>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div class="panel panel-default">
            <div class="panel-body">
                {% for report in reports %}
                <div class="row b-bottom">
                    <div class="col-lg-2 col-md-2 d-flex align-items-center">
                        {% if report.images.first %}
                        <div class="badge-image">
                            <span class="text">{{ report.files.count }}</span>
                            <img src="{{ report.images.first.file.url }}" class="img-responsive" alt="">
                        </div>
                        {% endif %}
                    </div>
                    <div class="col-lg-8 col-md-8 m-top">
                        <div class="row">
                            <div class="col-lg-10 col-md-10">
                                <h4 class="text-lg-left block">{{ report.name }}</h4>
                                <small class="text-lg-left"></small>{{ report.created_by.first_name }}
                            </div>
                            <div class="col-lg-2 col-md-2 text-right">{{ report.created_on|date:'d M Y' }}</div>
                        </div>

                        <div class="row">
                            <div class="col-lg-12 col-md-12">
                                <div class="badge badge-theme" style="background-color: #{{ report.theme.color }}">{{ report.theme.name }}</div>
                                {% for tag in report.tags.all %}
                                <div class="badge badge-tags">{{ tag.name }}</div>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-12 col-md-12">
                                {{ report.description|truncatewords:25 }}
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-2 b-left">
                        <div class="text-center">
                            <button type="button" class="btn btn-oval btn-default view">View</button>
                            <button type="button" class="btn btn-oval btn-default approve">Approve</button>
                            <p class="comments">{{ report.comments.count }} {% trans 'comments' %}</p>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            <div class="panel-footer">
                <div class="text-right">
                    <ul class="pagination pagination-sm ">
                        <li class="active"><a href="#">1</a>
                        </li>
                        <li><a href="#">2</a>
                        </li>
                        <li><a href="#">3</a>
                        </li>
                        <li><a href="#">Â»</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock content %}

{% block extrajs %}
<script type="text/javascript">
var form_action = '{% url 'voy-admin:reports:filter' %}';
var theme = $('#id_theme option:selected').val();
var tag = $('#id_tag option:selected').val();

$('#id_theme').change(function(e) {
    e.preventDefault();
    var theme = e.target.value;
    if (theme) {
        window.location = form_action + theme + (tag ? '?tag=' + tag : '');
    }
});

$('#id_tag').change(function(e) {
    e.preventDefault();
    var tag = e.target.value;
    window.location = form_action + theme + (tag ? '?tag=' + tag : '');
});
</script>
{% endblock extrajs %}
